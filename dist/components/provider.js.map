{"version":3,"sources":["../../src/components/provider.js"],"names":["noop","collapsePathMap","compose","unnest","filter","identity","values","FalcorProvider","arguments","_componentPathMap","falcor","props","componentPathMap","updatePaths","bind","removePaths","updateGraph","id","paths","persistPaths2Store","store","dispatch","type","subscribe","get","tapOnNext","jsonGraph","res","json","only","children","childContextTypes","PropTypes","object","func","propTypes","isRequired"],"mappings":";;;;;;;;AAAA;;;;AAKA;;;;;;;;;;;;;;AAEA,IAAMA,OAAO,SAAPA,IAAO,GAAM,CAAE,CAArB;AACA;AACA,IAAMC,kBAAkB,gBAAEC,OAAF,CACtB,gBAAEC,MADoB,EAEtB,gBAAEC,MAAF,CAAS,gBAAEC,QAAX,CAFsB,EAGtB,gBAAEC,MAHoB,CAAxB;;IAMMC,c;;;AACJ,4BAAc;AAAA;;AAAA,iIACHC,SADG;;AAEZ,UAAKC,iBAAL,GAAyB,EAAzB;AAFY;AAGb;;;;sCAEiB;AAChB,aAAO;AACLC,gBAAQ,KAAKC,KAAL,CAAWD,MADd;AAELE,0BAAkB,KAAKH,iBAFlB;AAGLI,qBAAa,KAAKA,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAHR;AAILC,qBAAa,KAAKA,WAAL,CAAiBD,IAAjB,CAAsB,IAAtB,CAJR;AAKLE,qBAAa,KAAKA,WAAL,CAAiBF,IAAjB,CAAsB,IAAtB;AALR,OAAP;AAOD;;;gCAEWG,E,EAAIC,K,EAAO;AACrB,WAAKT,iBAAL,CAAuBQ,EAAvB,IAA6BC,KAA7B;AACA,WAAKC,kBAAL,CAAwBlB,gBAAgB,KAAKQ,iBAArB,CAAxB;AACD;;;gCAEWQ,E,EAAI;AACd,aAAO,KAAKR,iBAAL,CAAuBQ,EAAvB,CAAP;AACA,WAAKE,kBAAL,CAAwBlB,gBAAgB,KAAKQ,iBAArB,CAAxB;AACD;;;uCAEkBS,K,EAAO;AACxB;AADwB,mBAEA,KAAKP,KAFL;AAAA,UAEjBD,MAFiB,UAEjBA,MAFiB;AAAA,UAETU,KAFS,UAETA,KAFS;;AAGxBA,YAAMC,QAAN,CAAe;AACbC,cAAM,8BADO;AAEbJ,eAAOA;AAFM,OAAf;;AAKA,WAAKF,WAAL,GAAmBO,SAAnB;AACD;;;kCAEa;AAAA,oBACY,KAAKZ,KADjB;AAAA,UACLD,MADK,WACLA,MADK;AAAA,UACGU,KADH,WACGA,KADH;;;AAGZ,aAAOV,OAAOc,GAAP,kCAAcvB,gBAAgB,KAAKQ,iBAArB,CAAd,GACJgB,SADI,CACM;AAAA,eAAOL,MAAMC,QAAN,CAAe;AAC/BC,gBAAM,8BADyB;AAE/BI,qBAAWC,IAAIC;AAFgB,SAAf,CAAP;AAAA,OADN,CAAP;AAKD;;;6BAEQ;AACP,aAAO,gBAASC,IAAT,CAAc,KAAKlB,KAAL,CAAWmB,QAAzB,CAAP;AACD;;;;;;AACF;;AAEDvB,eAAewB,iBAAf,GAAmC;AACjCrB,UAAQ,gBAAMsB,SAAN,CAAgBC,MADS;AAEjCrB,oBAAkB,gBAAMoB,SAAN,CAAgBC,MAFD;AAGjCpB,eAAa,gBAAMmB,SAAN,CAAgBE,IAHI;AAIjCnB,eAAa,gBAAMiB,SAAN,CAAgBE,IAJI;AAKjClB,eAAa,gBAAMgB,SAAN,CAAgBE;AALI,CAAnC;;AAQA3B,eAAe4B,SAAf,GAA2B;AACzBzB,UAAQ,gBAAMsB,SAAN,CAAgBC,MAAhB,CAAuBG,UADN;AAEzBhB,SAAO,gBAAMY,SAAN,CAAgBC,MAAhB,CAAuBG;AAFL,CAA3B;;kBAKe7B,c","file":"provider.js","sourcesContent":["import React,\n{\n  Component,\n  Children\n}              from 'react';\nimport R       from 'ramda';\n\nconst noop = () => {};\n// todo falcor_utils.collapse\nconst collapsePathMap = R.compose(\n  R.unnest,\n  R.filter(R.identity),\n  R.values\n);\n\nclass FalcorProvider extends Component {\n  constructor() {\n    super(...arguments);\n    this._componentPathMap = {};\n  }\n\n  getChildContext() {\n    return {\n      falcor: this.props.falcor,\n      componentPathMap: this._componentPathMap,\n      updatePaths: this.updatePaths.bind(this),\n      removePaths: this.removePaths.bind(this),\n      updateGraph: this.updateGraph.bind(this)\n    };\n  }\n\n  updatePaths(id, paths) {\n    this._componentPathMap[id] = paths;\n    this.persistPaths2Store(collapsePathMap(this._componentPathMap));\n  }\n\n  removePaths(id) {\n    delete this._componentPathMap[id];\n    this.persistPaths2Store(collapsePathMap(this._componentPathMap));\n  }\n\n  persistPaths2Store(paths) {\n    // TODO - debounce\n    const {falcor, store} = this.props;\n    store.dispatch({\n      type: 'falcor-provider/UPDATE_PATHS',\n      paths: paths\n    });\n\n    this.updateGraph().subscribe();\n  }\n\n  updateGraph() {\n    const {falcor, store} = this.props;\n\n    return falcor.get(...collapsePathMap(this._componentPathMap))\n      .tapOnNext(res => store.dispatch({\n        type: 'falcor-provider/UPDATE_GRAPH',\n        jsonGraph: res.json\n      }));\n  }\n\n  render() {\n    return Children.only(this.props.children);\n  }\n};\n\nFalcorProvider.childContextTypes = {\n  falcor: React.PropTypes.object,\n  componentPathMap: React.PropTypes.object,\n  updatePaths: React.PropTypes.func,\n  removePaths: React.PropTypes.func,\n  updateGraph: React.PropTypes.func\n};\n\nFalcorProvider.propTypes = {\n  falcor: React.PropTypes.object.isRequired,\n  store: React.PropTypes.object.isRequired\n};\n\nexport default FalcorProvider;\n"]}